<div class="modal-overlay" (click)="close.emit()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Send SMS to {{ student?.student_name || "" }}'s Parent</h2>
      <button class="close-btn" (click)="close.emit()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="recipient-info">
        <p><strong>Student:</strong> {{ student?.student_name || "" }}</p>
        <p>
          <strong>Parent's Phone:</strong> {{ student?.parent_phone_sms || "" }}
        </p>
      </div>

      <div class="form-group">
        <label for="message">Message</label>
        <textarea
          id="message"
          class="form-control"
          [ngModel]="message"
          (ngModelChange)="onMessageChange($event)"
          rows="5"
          placeholder="Type your message here..."
        >
        </textarea>
        <div class="char-counter">
          <span>{{ characterCount }} / 160 characters</span>
          <span
            >(Consumes {{ smsCreditsConsumed }} SMS credit<span
              *ngIf="smsCreditsConsumed > 1"
              >s</span
            >)</span
          >
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <div class="send-status" *ngIf="sendResult">
        <span
          [class.success]="sendResult.success"
          [class.error]="!sendResult.success"
          >{{ sendResult.message }}</span
        >
      </div>
      <!-- Toast container (transient) -->
      <div class="toast-container" *ngIf="toastVisible">
        <div
          class="toast"
          [class.success]="toastSuccess"
          [class.error]="!toastSuccess"
        >
          {{ toastMessage }}
        </div>
      </div>
      <button
        class="btn btn-secondary"
        (click)="close.emit()"
        [disabled]="isSending"
      >
        Cancel
      </button>
      <button
        class="btn btn-primary"
        (click)="sendSms()"
        [disabled]="!message || isSending"
      >
        <span *ngIf="isSending">Sending...</span>
        <span *ngIf="!isSending">Send SMS</span>
      </button>
    </div>
  </div>
</div>
