<div class="grading-config">
  <div class="header">
    <h1>Grading Configuration</h1>
    <button (click)="goBack()" class="btn-secondary">Back to Dashboard</button>
  </div>

  <div class="config-container">
    <!-- School Settings Section -->
    <div class="section">
      <h2>School Settings</h2>
      <div class="form-group">
        <label>Curriculum Type *</label>
        <select [(ngModel)]="curriculumType" name="curriculumType">
          <option *ngFor="let type of curriculumOptions" [value]="type">
            {{ type }}
          </option>
        </select>
        <small
          >Primary-Local: P1-P7 curriculum | Secondary-LSC: S1-S4 LSC curriculum
          | International: Custom curriculum</small
        >
      </div>
    </div>

    <!-- Assessment Weights Section -->
    <div class="section">
      <h2>Assessment Weights</h2>
      <p class="info">
        Define the contribution of Formative (CA) and Summative (End-of-Term)
        scores.
      </p>
      <div class="weight-row">
        <div class="form-group">
          <label>Formative (CA) Weight (%) *</label>
          <input
            type="number"
            [(ngModel)]="formativeWeight"
            name="formativeWeight"
            min="0"
            max="100"
            (change)="onWeightChange()"
          />
        </div>
        <div class="form-group">
          <label>Summative Weight (%) *</label>
          <input
            type="number"
            [(ngModel)]="summativeWeight"
            name="summativeWeight"
            min="0"
            max="100"
            (change)="onWeightChange()"
          />
        </div>
      </div>
      <div class="weight-total">
        <strong>Total: {{ formativeWeight + summativeWeight }}%</strong>
        <span *ngIf="formativeWeight + summativeWeight === 100" class="success"
          >✓ Valid</span
        >
        <span *ngIf="formativeWeight + summativeWeight !== 100" class="error"
          >✗ Must equal 100%</span
        >
      </div>
    </div>

    <!-- Grading Scale Section -->
    <div class="section">
      <h2>Grading Scale</h2>
      <div class="form-group">
        <label>Select Grading Scale Type *</label>
        <select
          [(ngModel)]="gradingScaleType"
          name="gradingScaleType"
          (change)="onGradingScaleTypeChange()"
        >
          <option
            *ngFor="let type of gradingScaleOptions"
            [value]="type.split('(')[0].trim()"
          >
            {{ type }}
          </option>
        </select>
      </div>

      <div class="scale-table">
        <table>
          <thead>
            <tr>
              <th>Grade</th>
              <th>Descriptor</th>
              <th>Min Score (%)</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let scale of currentScale">
              <td>
                <strong>{{ scale.grade_letter }}</strong>
              </td>
              <td>
                <input
                  type="text"
                  [value]="scale.descriptor"
                  (change)="
                    updateGradeDescriptor(scale, $any($event.target).value)
                  "
                />
              </td>
              <td>
                <input
                  type="number"
                  [value]="scale.min_score_percent"
                  (change)="
                    updateGradeThreshold(scale, +$any($event.target).value)
                  "
                  min="0"
                  max="100"
                />
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="actions">
      <button
        (click)="saveGradingConfig()"
        [disabled]="saving || formativeWeight + summativeWeight !== 100"
        class="btn-primary"
      >
        {{ saving ? "Saving..." : "Save Configuration" }}
      </button>
      <button (click)="goBack()" class="btn-secondary">Cancel</button>
    </div>
  </div>
</div>
