<div class="modal-overlay" (click)="cancel()">
  <div class="modal-card" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">Edit School</h2>
      <button type="button" class="close-btn" aria-label="Close" (click)="cancel()">
        &times;
      </button>
    </div>
    <form [formGroup]="form" (ngSubmit)="save()">
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">School Name</label>
          <input class="form-control" formControlName="school_name" />
        </div>

        <div class="form-group">
          <label class="form-label">Admin Phone</label>
          <input class="form-control" formControlName="admin_phone" />
        </div>

        <div class="form-group">
          <label class="form-label">Accountant Phone</label>
          <input class="form-control" formControlName="accountant_number" />
        </div>

        <div class="form-group">
          <label class="form-label">District</label>
          <select class="form-control" formControlName="location_district">
            <option value="" disabled>Select a district</option>
            <option *ngFor="let d of districts" [value]="d">{{ d }}</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">School Type</label>
          <select class="form-control" formControlName="school_type">
            <option value="" disabled>Select a school type</option>
            <option *ngFor="let t of schoolTypes" [value]="t">{{ t }}</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Number of Students</label>
          <select class="form-control" formControlName="student_count_range">
            <option value="" disabled>Select a range</option>
            <option *ngFor="let r of studentCountRanges" [value]="r">{{ r }}</option>
          </select>
        </div>

        <!-- Badge Section -->
        <div class="form-group" style="margin-top: 20px; border-top: 1px solid #eee; padding-top: 15px;">
          <label class="form-label">School Badge</label>

          <div class="badge-actions" style="display: flex; align-items: flex-start; gap: 15px;">
            <!-- Preview -->
            <div class="badge-preview-container"
              style="width: 80px; height: 80px; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; display: flex; align-items: center; justify-content: center; background: #f9f9f9;">
              <img *ngIf="previewUrl" [src]="previewUrl" alt="Badge"
                style="max-width: 100%; max-height: 100%; object-fit: contain;">
              <span *ngIf="!previewUrl" style="font-size: 10px; color: #999;">No Badge</span>
            </div>

            <!-- Actions -->
            <div class="actions" style="flex: 1;">
              <div *ngIf="!isUploadingBadge">
                <input type="file" (change)="onFileSelected($event)" accept="image/*"
                  style="margin-bottom: 10px; display: block; width: 100%;">

                <div style="display: flex; gap: 10px;">
                  <button type="button" class="btn btn-sm btn-success" *ngIf="selectedFile" (click)="uploadBadge()">
                    Upload New
                  </button>
                  <button type="button" class="btn btn-sm btn-danger" *ngIf="previewUrl && !selectedFile"
                    (click)="deleteBadge()">
                    Remove Badge
                  </button>
                </div>
              </div>

              <!-- Progress -->
              <div *ngIf="isUploadingBadge" class="progress-container">
                <p style="margin: 0 0 5px; font-size: 12px;">Uploading...</p>
                <div class="progress" style="height: 6px; background: #eee; border-radius: 3px; overflow: hidden;">
                  <div class="progress-bar" [style.width.%]="uploadProgress"
                    style="height: 100%; background: #28a745; transition: width 0.3s;"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="cancel()">
          Cancel
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="form.invalid">
          Save Changes
        </button>
      </div>
    </form>
  </div>
</div>